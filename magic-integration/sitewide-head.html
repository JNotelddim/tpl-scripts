<!-- From: https://magic.link/posts/magic-webflow -->

<!-- GENERAL SITE HEAD -->

<!-- Get Magic SDK -->
<script src="https://auth.magic.link/sdk"></script>


<script>
    /**
     * Initialize Magic
     * From: https://magic.link/posts/magic-webflow
    */
    const magic = new Magic("pk_live_9A73296BE1EA06BB");


    /** CONSTS -- these are variables that are fixed + unchanging **/
    const loggedInPages = [/\/profile/i, /\/explore/i, /\/project/i];  // ["/profile", "/explore", "/project"];
    const unloggedInPages = [/\/$/, /\/login/i ]; // ["/", "/login"];

    /** HANDLER FUNCTIONS -- these functions describe how to handle particular scenarios **/
    const pathInList = (path) => {

    }
    const handleRedirectToLogin = () => {
        console.log('handleRedirectToLogin')
        window.location.replace('/login');
    }
    const handleRedirectToExplore = () => {
        console.log('handleRedirectToExplore')
        window.location.replace('/explore');
    }

    /** getUser checks if there's a logged in user and then updates the app state accordingly. **/
    const getUser = async () => {
        console.log("getUser()");
        const currentPath = window.location.pathname;
        const isLoggedIn = await magic.user.isLoggedIn();

        if (isLoggedIn) {
            // The use is logged in
            if (unloggedInPages.some((pattern) => pattern.test(currentPath))) {
                // The user is trying to see a page that's only for users who aren't signed in.
                handleRedirectToExplore();
            }
        } else {
            // The user is not logged in
            if (loggedInPages.some((pattern) => pattern.test(currentPath))) {
                // The user is trying to see a page which is only for users who are signed in.
                handleRedirectToLogin();
            }
        }
    };
    window.getUser = getUser;
    console.log("siteInit");

</script>